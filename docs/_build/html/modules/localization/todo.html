<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RTKLocalization &mdash; dig-into-apollo  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> dig-into-apollo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../what_is_apollo/readme.html">Dig into Apollo - Introduction </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cyber/readme.html">Dig into Apollo - Cyber </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/readme.html">Dig into Apollo - Docker </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../library/readme.html">Dig into Apollo - Library </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../papers/readme.html">Dig into Apollo - Papers </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/readme.html">Dig into Apollo - Performance </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../questions/readme.html">Dig into Apollo - Questions </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulation/readme.html">Dig into Apollo - Simulation </a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_build/readme.html">Dig into Apollo - Build </a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dig-into-apollo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>RTKLocalization</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/localization/todo.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="rtklocalization">
<h1>RTKLocalization<a class="headerlink" href="#rtklocalization" title="Permalink to this headline"></a></h1>
<p>RTKLocalization类的主要功能是实现RTK定位，然后用IMU做插值。</p>
<ol class="arabic simple">
<li><p>只是通过GPS得到了位置，但是IMU的融合还没有进行计算？？？</p></li>
<li><p>姿态解算是如何进行的？？？</p></li>
</ol>
<div class="section" id="initconfig">
<h2>InitConfig<a class="headerlink" href="#initconfig" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalization</span><span class="p">::</span><span class="n">InitConfig</span><span class="p">(</span><span class="n">const</span> <span class="n">rtk_config</span><span class="p">::</span><span class="n">Config</span> <span class="o">&amp;</span><span class="n">config</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">imu队列最大长度</span>
  <span class="n">imu_list_max_size_</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">imu_list_max_size</span><span class="p">();</span>
  <span class="o">//</span> <span class="n">GPS和IMU最大时间间隔</span>
  <span class="n">gps_imu_time_diff_threshold_</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">gps_imu_time_diff_threshold</span><span class="p">();</span>
  <span class="o">//</span> <span class="n">地图偏移</span>
  <span class="n">map_offset_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">map_offset_x</span><span class="p">();</span>
  <span class="n">map_offset_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">map_offset_y</span><span class="p">();</span>
  <span class="n">map_offset_</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">map_offset_z</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="gpscallback">
<h2>GpsCallback<a class="headerlink" href="#gpscallback" title="Permalink to this headline"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RTKLocalization::GpsCallback</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">localization</span><span class="o">::</span><span class="n">Gps</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gps_msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_delay</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="n">last_received_timestamp_sec_</span><span class="w"></span>
<span class="w">          </span><span class="o">?</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">time</span><span class="o">::</span><span class="n">Clock</span><span class="o">::</span><span class="n">NowInSeconds</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">last_received_timestamp_sec_</span><span class="w"></span>
<span class="w">          </span><span class="o">:</span><span class="w"> </span><span class="n">last_received_timestamp_sec_</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="c1">// GPS超时</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">time_delay</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">gps_time_delay_tolerance_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">ss</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">ss</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;GPS message time interval: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">time_delay</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">monitor_logger_</span><span class="p">.</span><span class="n">WARN</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">());</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">imu_list_mutex_</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 判断IMU消息是否为空，为空则返回</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu_list_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;IMU message buffer is empty.&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">service_started_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">monitor_logger_</span><span class="p">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s">&quot;IMU message buffer is empty.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">gps_status_list_mutex_</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 判断GPS状态是否为空，为空则返回</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gps_status_list_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Gps status message buffer is empty.&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">service_started_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">monitor_logger_</span><span class="p">.</span><span class="n">ERROR</span><span class="p">(</span><span class="s">&quot;Gps status message buffer is empty.&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">      </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// publish localization messages</span>
<span class="w">  </span><span class="c1">// 主要的处理过程都在该函数中</span>
<span class="w">  </span><span class="n">PrepareLocalizationMsg</span><span class="p">(</span><span class="o">*</span><span class="n">gps_msg</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">last_localization_result_</span><span class="p">,</span><span class="w"></span>
<span class="w">                         </span><span class="o">&amp;</span><span class="n">last_localization_status_result_</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="c1">// 开启定位服务，并且记录服务开始时间</span>
<span class="w">  </span><span class="n">service_started_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">service_started_time</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">service_started_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">time</span><span class="o">::</span><span class="n">Clock</span><span class="o">::</span><span class="n">NowInSeconds</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="c1">// watch dog</span>
<span class="w">  </span><span class="c1">// 看门狗，主要根据时间来判断？？？</span>
<span class="w">  </span><span class="n">RunWatchDog</span><span class="p">(</span><span class="n">gps_msg</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">());</span><span class="w"></span>

<span class="w">  </span><span class="c1">// 最后一次消息接收时间</span>
<span class="w">  </span><span class="n">last_received_timestamp_sec_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">time</span><span class="o">::</span><span class="n">Clock</span><span class="o">::</span><span class="n">NowInSeconds</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>开门狗<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void RTKLocalization::RunWatchDog(double gps_timestamp) {
  if (!enable_watch_dog_) {
    return;
  }

  // 定位服务启动后，GPS超时则设置msg_delay为真
  // check GPS time stamp against system time
  double gps_delay_sec = common::time::Clock::NowInSeconds() - gps_timestamp;
  double gps_service_delay =
      common::time::Clock::NowInSeconds() - service_started_time;
  int64_t gps_delay_cycle_cnt =
      static_cast&lt;int64_t&gt;(gps_delay_sec * localization_publish_freq_);

  bool msg_delay = false;
  if (gps_delay_cycle_cnt &gt; report_threshold_err_num_ &amp;&amp;
      static_cast&lt;int&gt;(gps_service_delay) &gt; service_delay_threshold) {
    msg_delay = true;
    std::stringstream ss;
    ss &lt;&lt; &quot;Raw GPS Message Delay. GPS message is &quot; &lt;&lt; gps_delay_cycle_cnt
       &lt;&lt; &quot; cycle &quot; &lt;&lt; gps_delay_sec &lt;&lt; &quot; sec behind current time.&quot;;
    monitor_logger_.ERROR(ss.str());
  }
   
  // 定位服务启动之后，IMU超时则设置msg_delay为真
  // check IMU time stamp against system time
  std::unique_lock&lt;std::mutex&gt; lock(imu_list_mutex_);
  auto imu_msg = imu_list_.back();
  lock.unlock();
  double imu_delay_sec =
      common::time::Clock::NowInSeconds() - imu_msg.header().timestamp_sec();
  int64_t imu_delay_cycle_cnt =
      static_cast&lt;int64_t&gt;(imu_delay_sec * localization_publish_freq_);
  if (imu_delay_cycle_cnt &gt; report_threshold_err_num_ &amp;&amp;
      static_cast&lt;int&gt;(gps_service_delay) &gt; service_delay_threshold) {
    msg_delay = true;
    std::stringstream ss;
    ss &lt;&lt; &quot;Raw IMU Message Delay. IMU message is &quot; &lt;&lt; imu_delay_cycle_cnt
       &lt;&lt; &quot; cycle &quot; &lt;&lt; imu_delay_sec &lt;&lt; &quot; sec behind current time.&quot;;
    monitor_logger_.ERROR(ss.str());
  }

  // 第一次触发之后，然后每隔1s触发一次
  // to prevent it from beeping continuously
  if (msg_delay &amp;&amp; (last_reported_timestamp_sec_ &lt; 1. ||
                    common::time::Clock::NowInSeconds() &gt;
                        last_reported_timestamp_sec_ + 1.)) {
    AERROR &lt;&lt; &quot;gps/imu frame Delay!&quot;;
    last_reported_timestamp_sec_ = common::time::Clock::NowInSeconds();
  }
}
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h2>定位主流程<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalization</span><span class="p">::</span><span class="n">PrepareLocalizationMsg</span><span class="p">(</span>
    <span class="n">const</span> <span class="n">localization</span><span class="p">::</span><span class="n">Gps</span> <span class="o">&amp;</span><span class="n">gps_msg</span><span class="p">,</span> <span class="n">LocalizationEstimate</span> <span class="o">*</span><span class="n">localization</span><span class="p">,</span>
    <span class="n">LocalizationStatus</span> <span class="o">*</span><span class="n">localization_status</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">根据GPS时间寻找匹配的IMU消息</span>
  <span class="o">//</span> <span class="n">find</span> <span class="n">the</span> <span class="n">matching</span> <span class="n">gps</span> <span class="ow">and</span> <span class="n">imu</span> <span class="n">message</span>
  <span class="n">double</span> <span class="n">gps_time_stamp</span> <span class="o">=</span> <span class="n">gps_msg</span><span class="o">.</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp_sec</span><span class="p">();</span>
  <span class="n">CorrectedImu</span> <span class="n">imu_msg</span><span class="p">;</span>
  <span class="n">FindMatchingIMU</span><span class="p">(</span><span class="n">gps_time_stamp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">imu_msg</span><span class="p">);</span>

  <span class="o">//</span> <span class="n">构建定位消息</span>
  <span class="n">ComposeLocalizationMsg</span><span class="p">(</span><span class="n">gps_msg</span><span class="p">,</span> <span class="n">imu_msg</span><span class="p">,</span> <span class="n">localization</span><span class="p">);</span>


  <span class="n">drivers</span><span class="p">::</span><span class="n">gnss</span><span class="p">::</span><span class="n">InsStat</span> <span class="n">gps_status</span><span class="p">;</span>
  <span class="o">//</span> <span class="n">查找最近的GPS状态信息</span>
  <span class="n">FindNearestGpsStatus</span><span class="p">(</span><span class="n">gps_time_stamp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gps_status</span><span class="p">);</span>
  <span class="o">//</span> <span class="n">填充定位状态信息</span>
  <span class="n">FillLocalizationStatusMsg</span><span class="p">(</span><span class="n">gps_status</span><span class="p">,</span> <span class="n">localization_status</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="imu">
<h2>找到正确的IMU消息<a class="headerlink" href="#imu" title="Permalink to this headline"></a></h2>
<p>在队列中找到最匹配的IMU，其中区分了队列的第一个，最后一个，以及如果在中间则进行插值。插值的时候根据距离最近的原则进行反比例插值。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bool RTKLocalization::FindMatchingIMU(const double gps_timestamp_sec,
                                      CorrectedImu *imu_msg) {
  // 1. 判断消息是否为空
  if (imu_msg == nullptr) {
    AERROR &lt;&lt; &quot;imu_msg should NOT be nullptr.&quot;;
    return false;
  }
  // 加锁，这里有疑问，为什么换个变量就没有锁了呢？
  std::unique_lock&lt;std::mutex&gt; lock(imu_list_mutex_);
  auto imu_list = imu_list_;
  lock.unlock();

  // IMU为空
  if (imu_list.empty()) {
    AERROR &lt;&lt; &quot;Cannot find Matching IMU. &quot;
           &lt;&lt; &quot;IMU message Queue is empty! GPS timestamp[&quot; &lt;&lt; gps_timestamp_sec
           &lt;&lt; &quot;]&quot;;
    return false;
  }

  // 
  // scan imu buffer, find first imu message that is newer than the given
  // timestamp
  auto imu_it = imu_list.begin();
  for (; imu_it != imu_list.end(); ++imu_it) {
    if ((*imu_it).header().timestamp_sec() - gps_timestamp_sec &gt;
        std::numeric_limits&lt;double&gt;::min()) {
      break;
    }
  }

  if (imu_it != imu_list.end()) {  // found one
    if (imu_it == imu_list.begin()) {
      AERROR &lt;&lt; &quot;IMU queue too short or request too old. &quot;
             &lt;&lt; &quot;Oldest timestamp[&quot; &lt;&lt; imu_list.front().header().timestamp_sec()
             &lt;&lt; &quot;], Newest timestamp[&quot;
             &lt;&lt; imu_list.back().header().timestamp_sec() &lt;&lt; &quot;], GPS timestamp[&quot;
             &lt;&lt; gps_timestamp_sec &lt;&lt; &quot;]&quot;;
      *imu_msg = imu_list.front();  // the oldest imu
    } else {
      // here is the normal case
      auto imu_it_1 = imu_it;
      imu_it_1--;
      if (!(*imu_it).has_header() || !(*imu_it_1).has_header()) {
        AERROR &lt;&lt; &quot;imu1 and imu_it_1 must both have header.&quot;;
        return false;
      }
      if (!InterpolateIMU(*imu_it_1, *imu_it, gps_timestamp_sec, imu_msg)) {
        AERROR &lt;&lt; &quot;failed to interpolate IMU&quot;;
        return false;
      }
    }
  } else {
    // 如果没有找到，则取最新的20ms以内的消息
    // give the newest imu, without extrapolation
    *imu_msg = imu_list.back();
    if (imu_msg == nullptr) {
      AERROR &lt;&lt; &quot;Fail to get latest observed imu_msg.&quot;;
      return false;
    }

    if (!imu_msg-&gt;has_header()) {
      AERROR &lt;&lt; &quot;imu_msg must have header.&quot;;
      return false;
    }

    if (std::fabs(imu_msg-&gt;header().timestamp_sec() - gps_timestamp_sec) &gt;
        gps_imu_time_diff_threshold_) {
      // 20ms threshold to report error
      AERROR &lt;&lt; &quot;Cannot find Matching IMU. IMU messages too old. &quot;
             &lt;&lt; &quot;Newest timestamp[&quot; &lt;&lt; imu_list.back().header().timestamp_sec()
             &lt;&lt; &quot;], GPS timestamp[&quot; &lt;&lt; gps_timestamp_sec &lt;&lt; &quot;]&quot;;
    }
  }

  return true;
}
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>IMU插值<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h2>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span><span class="w"> </span><span class="nf">RTKLocalization::InterpolateIMU</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">CorrectedImu</span><span class="w"> </span><span class="o">&amp;</span><span class="n">imu1</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="n">CorrectedImu</span><span class="w"> </span><span class="o">&amp;</span><span class="n">imu2</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">timestamp_sec</span><span class="p">,</span><span class="w"></span>
<span class="w">                                     </span><span class="n">CorrectedImu</span><span class="w"> </span><span class="o">*</span><span class="n">imu_msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">has_timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">        </span><span class="n">imu2</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">has_timestamp_sec</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;imu1 and imu2 has no header or no timestamp_sec in header&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp_sec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imu1</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"></span>
<span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">min</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[InterpolateIMU1]: the given time stamp[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">timestamp_sec</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] is older than the 1st message[&quot;</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">imu1</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">imu_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">timestamp_sec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imu2</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"></span>
<span class="w">             </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">min</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[InterpolateIMU2]: the given time stamp[&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">timestamp_sec</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;] is newer than the 2nd message[&quot;</span><span class="w"></span>
<span class="w">           </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">imu2</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="n">imu_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu1</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 线性插值</span>
<span class="w">    </span><span class="o">*</span><span class="n">imu_msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">mutable_header</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_timestamp_sec</span><span class="p">(</span><span class="n">timestamp_sec</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">time_diff</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">        </span><span class="n">imu2</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imu1</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">0.001</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">frac1</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="n">timestamp_sec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">imu1</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time_diff</span><span class="p">;</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_angular_velocity</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">          </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_angular_velocity</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InterpolateXYZ</span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">angular_velocity</span><span class="p">(),</span><span class="w"></span>
<span class="w">                                  </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">angular_velocity</span><span class="p">(),</span><span class="w"> </span><span class="n">frac1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">mutable_imu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mutable_angular_velocity</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_linear_acceleration</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"></span>
<span class="w">          </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_linear_acceleration</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InterpolateXYZ</span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">linear_acceleration</span><span class="p">(),</span><span class="w"></span>
<span class="w">                                  </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">linear_acceleration</span><span class="p">(),</span><span class="w"> </span><span class="n">frac1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">mutable_imu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mutable_linear_acceleration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>

<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_euler_angles</span><span class="p">()</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">has_euler_angles</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">InterpolateXYZ</span><span class="p">(</span><span class="n">imu1</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">euler_angles</span><span class="p">(),</span><span class="w"></span>
<span class="w">                                  </span><span class="n">imu2</span><span class="p">.</span><span class="n">imu</span><span class="p">().</span><span class="n">euler_angles</span><span class="p">(),</span><span class="w"> </span><span class="n">frac1</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">imu_msg</span><span class="o">-&gt;</span><span class="n">mutable_imu</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mutable_euler_angles</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">val</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h2>线性插值算法<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h2>
<p>根据距离插值，反比例，即frac1越小，则越靠近p1，frac1越大，则越靠近p2</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>template &lt;class T&gt;
T RTKLocalization::InterpolateXYZ(const T &amp;p1, const T &amp;p2,
                                  const double frac1) {
  T p;
  double frac2 = 1.0 - frac1;
  if (p1.has_x() &amp;&amp; !std::isnan(p1.x()) &amp;&amp; p2.has_x() &amp;&amp; !std::isnan(p2.x())) {
    p.set_x(p1.x() * frac2 + p2.x() * frac1);
  }
  if (p1.has_y() &amp;&amp; !std::isnan(p1.y()) &amp;&amp; p2.has_y() &amp;&amp; !std::isnan(p2.y())) {
    p.set_y(p1.y() * frac2 + p2.y() * frac1);
  }
  if (p1.has_z() &amp;&amp; !std::isnan(p1.z()) &amp;&amp; p2.has_z() &amp;&amp; !std::isnan(p2.z())) {
    p.set_z(p1.z() * frac2 + p2.z() * frac1);
  }
  return p;
}
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h2>填充定位消息<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h2>
<p>找到最匹配的IMU消息后，和GPS消息做融合。IMU的角度是否不随着物体的旋转而改变？？？
涉及到姿态解算
https://blog.csdn.net/MOU_IT/article/details/80369043
https://zhuanlan.zhihu.com/p/79894982
https://zhuanlan.zhihu.com/p/20382236</p>
<p>位置，航向，线速度是GPS的
加速度，角速度，欧拉角是IMU的</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">RTKLocalization::ComposeLocalizationMsg</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">localization</span><span class="o">::</span><span class="n">Gps</span><span class="w"> </span><span class="o">&amp;</span><span class="n">gps_msg</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">localization</span><span class="o">::</span><span class="n">CorrectedImu</span><span class="w"> </span><span class="o">&amp;</span><span class="n">imu_msg</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">LocalizationEstimate</span><span class="w"> </span><span class="o">*</span><span class="n">localization</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">();</span><span class="w"></span>

<span class="w">  </span><span class="n">FillLocalizationMsgHeader</span><span class="p">(</span><span class="n">localization</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">set_measurement_time</span><span class="p">(</span><span class="n">gps_msg</span><span class="p">.</span><span class="n">header</span><span class="p">().</span><span class="n">timestamp_sec</span><span class="p">());</span><span class="w"></span>

<span class="w">  </span><span class="c1">// combine gps and imu</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">mutable_pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">mutable_pose</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="c1">// GPS消息包含位置信息</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">gps_msg</span><span class="p">.</span><span class="n">has_localization</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gps_msg</span><span class="p">.</span><span class="n">localization</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 1. 获取位置</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">has_position</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="c1">// position</span>
<span class="w">      </span><span class="c1">// world frame -&gt; map frame</span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_position</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_x</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">().</span><span class="n">x</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="w">                                              </span><span class="n">map_offset_</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_position</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_y</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">().</span><span class="n">y</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="w">                                              </span><span class="n">map_offset_</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_position</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_z</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">position</span><span class="p">().</span><span class="n">z</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"></span>
<span class="w">                                              </span><span class="n">map_offset_</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// 2. 获取方向</span>
<span class="w">    </span><span class="c1">// orientation</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">has_orientation</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_orientation</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="kt">double</span><span class="w"> </span><span class="n">heading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">math</span><span class="o">::</span><span class="n">QuaternionToHeading</span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">().</span><span class="n">qw</span><span class="p">(),</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">().</span><span class="n">qx</span><span class="p">(),</span><span class="w"></span>
<span class="w">          </span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">().</span><span class="n">qy</span><span class="p">(),</span><span class="w"> </span><span class="n">pose</span><span class="p">.</span><span class="n">orientation</span><span class="p">().</span><span class="n">qz</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">set_heading</span><span class="p">(</span><span class="n">heading</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="c1">// linear velocity</span>
<span class="w">    </span><span class="c1">// 获取线速度</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">has_linear_velocity</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_linear_velocity</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">pose</span><span class="p">.</span><span class="n">linear_velocity</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu_msg</span><span class="p">.</span><span class="n">has_imu</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">imu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imu_msg</span><span class="p">.</span><span class="n">imu</span><span class="p">();</span><span class="w"></span>
<span class="w">    </span><span class="c1">// linear acceleration</span>
<span class="w">    </span><span class="c1">// 获取imu的线性</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">has_linear_acceleration</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">().</span><span class="n">has_orientation</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// linear_acceleration:</span>
<span class="w">        </span><span class="c1">// convert from vehicle reference to map reference</span>
<span class="w">        </span><span class="c1">// 为什么需要做旋转？？？转换为车当前方向的速度？？？</span>
<span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">orig</span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">().</span><span class="n">x</span><span class="p">(),</span><span class="w"></span>
<span class="w">                      </span><span class="n">imu</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">().</span><span class="n">y</span><span class="p">(),</span><span class="w"></span>
<span class="w">                      </span><span class="n">imu</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">().</span><span class="n">z</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">math</span><span class="o">::</span><span class="n">QuaternionRotate</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">().</span><span class="n">orientation</span><span class="p">(),</span><span class="w"> </span><span class="n">orig</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_linear_acceleration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_x</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_linear_acceleration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_y</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_linear_acceleration</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_z</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// linear_acceleration_vfr</span>
<span class="w">        </span><span class="c1">// 设置线性加速度</span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_linear_acceleration_vrf</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">imu</span><span class="p">.</span><span class="n">linear_acceleration</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[PrepareLocalizationMsg]: &quot;</span><span class="w"></span>
<span class="w">               </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;fail to convert linear_acceleration&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">//设置角速度，也需要根据航向转换</span>
<span class="w">    </span><span class="c1">// angular velocity</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">has_angular_velocity</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">().</span><span class="n">has_orientation</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// angular_velocity:</span>
<span class="w">        </span><span class="c1">// convert from vehicle reference to map reference</span>
<span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">orig</span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">().</span><span class="n">x</span><span class="p">(),</span><span class="w"> </span><span class="n">imu</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">().</span><span class="n">y</span><span class="p">(),</span><span class="w"></span>
<span class="w">                      </span><span class="n">imu</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">().</span><span class="n">z</span><span class="p">());</span><span class="w"></span>
<span class="w">        </span><span class="n">Vector3d</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">common</span><span class="o">::</span><span class="n">math</span><span class="o">::</span><span class="n">QuaternionRotate</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">localization</span><span class="o">-&gt;</span><span class="n">pose</span><span class="p">().</span><span class="n">orientation</span><span class="p">(),</span><span class="w"> </span><span class="n">orig</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_angular_velocity</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_x</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_angular_velocity</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_y</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span><span class="w"></span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_angular_velocity</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">set_z</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span><span class="w"></span>

<span class="w">        </span><span class="c1">// angular_velocity_vf</span>
<span class="w">        </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_angular_velocity_vrf</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="n">imu</span><span class="p">.</span><span class="n">angular_velocity</span><span class="p">());</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="n">AERROR</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;[PrepareLocalizationMsg]: fail to convert angular_velocity&quot;</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="p">}</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="c1">// 设置欧拉角</span>
<span class="w">    </span><span class="c1">// euler angle</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">has_euler_angles</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">      </span><span class="n">mutable_pose</span><span class="o">-&gt;</span><span class="n">mutable_euler_angles</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">CopyFrom</span><span class="p">(</span><span class="n">imu</span><span class="p">.</span><span class="n">euler_angles</span><span class="p">());</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="localiztion">
<h2>设置localiztion消息头<a class="headerlink" href="#localiztion" title="Permalink to this headline"></a></h2>
<p>填充消息头</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalization</span><span class="p">::</span><span class="n">FillLocalizationMsgHeader</span><span class="p">(</span>
    <span class="n">LocalizationEstimate</span> <span class="o">*</span><span class="n">localization</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">auto</span> <span class="o">*</span><span class="n">header</span> <span class="o">=</span> <span class="n">localization</span><span class="o">-&gt;</span><span class="n">mutable_header</span><span class="p">();</span>
  <span class="n">double</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">apollo</span><span class="p">::</span><span class="n">common</span><span class="p">::</span><span class="n">time</span><span class="p">::</span><span class="n">Clock</span><span class="p">::</span><span class="n">NowInSeconds</span><span class="p">();</span>
  <span class="n">header</span><span class="o">-&gt;</span><span class="n">set_module_name</span><span class="p">(</span><span class="n">module_name_</span><span class="p">);</span>
  <span class="n">header</span><span class="o">-&gt;</span><span class="n">set_timestamp_sec</span><span class="p">(</span><span class="n">timestamp</span><span class="p">);</span>
  <span class="n">header</span><span class="o">-&gt;</span><span class="n">set_sequence_num</span><span class="p">(</span><span class="n">static_cast</span><span class="o">&lt;</span><span class="n">unsigned</span> <span class="nb">int</span><span class="o">&gt;</span><span class="p">(</span><span class="o">++</span><span class="n">localization_seq_num_</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gps">
<h1>查找最新的GPS状态<a class="headerlink" href="#gps" title="Permalink to this headline"></a></h1>
<p>GPS状态列表可能是乱序的吗？不是按照时间顺序排列的？？？</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">RTKLocalization</span><span class="p">::</span><span class="n">FindNearestGpsStatus</span><span class="p">(</span><span class="n">const</span> <span class="n">double</span> <span class="n">gps_timestamp_sec</span><span class="p">,</span>
                                           <span class="n">drivers</span><span class="p">::</span><span class="n">gnss</span><span class="p">::</span><span class="n">InsStat</span> <span class="o">*</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">CHECK_NOTNULL</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>

  <span class="n">std</span><span class="p">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="p">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">gps_status_list_mutex_</span><span class="p">);</span>
  <span class="n">auto</span> <span class="n">gps_status_list</span> <span class="o">=</span> <span class="n">gps_status_list_</span><span class="p">;</span>
  <span class="n">lock</span><span class="o">.</span><span class="n">unlock</span><span class="p">();</span>

  <span class="n">double</span> <span class="n">timestamp_diff_sec</span> <span class="o">=</span> <span class="mf">1e8</span><span class="p">;</span>
  <span class="n">auto</span> <span class="n">nearest_itr</span> <span class="o">=</span> <span class="n">gps_status_list</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">auto</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">gps_status_list</span><span class="o">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">itr</span> <span class="o">!=</span> <span class="n">gps_status_list</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
       <span class="o">++</span><span class="n">itr</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">double</span> <span class="n">diff</span> <span class="o">=</span> <span class="n">std</span><span class="p">::</span><span class="nb">abs</span><span class="p">(</span><span class="n">itr</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp_sec</span><span class="p">()</span> <span class="o">-</span> <span class="n">gps_timestamp_sec</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="n">timestamp_diff_sec</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">timestamp_diff_sec</span> <span class="o">=</span> <span class="n">diff</span><span class="p">;</span>
      <span class="n">nearest_itr</span> <span class="o">=</span> <span class="n">itr</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">nearest_itr</span> <span class="o">==</span> <span class="n">gps_status_list</span><span class="o">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">timestamp_diff_sec</span> <span class="o">&gt;</span> <span class="n">gps_status_time_diff_threshold_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="o">*</span><span class="n">status</span> <span class="o">=</span> <span class="o">*</span><span class="n">nearest_itr</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">true</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id6">
<h1>增加位置的状态信息<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h1>
<p>设置位置的状态，主要是为RTK的状态信息</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>void RTKLocalization::FillLocalizationStatusMsg(
    const drivers::gnss::InsStat &amp;status,
    LocalizationStatus *localization_status) {
  apollo::common::Header *header = localization_status-&gt;mutable_header();
  double timestamp = apollo::common::time::Clock::NowInSeconds();
  header-&gt;set_timestamp_sec(timestamp);
  localization_status-&gt;set_measurement_time(status.header().timestamp_sec());
  
  // 如果没有pose type则返回错误
  if (!status.has_pos_type()) {
    localization_status-&gt;set_fusion_status(MeasureState::ERROR);
    localization_status-&gt;set_state_message(
        &quot;Error: Current Localization Status Is Missing.&quot;);
    return;
  }

  auto pos_type = static_cast&lt;drivers::gnss::SolutionType&gt;(status.pos_type());
  switch (pos_type) {
    // RTK FIXED状态
    case drivers::gnss::SolutionType::INS_RTKFIXED:
      localization_status-&gt;set_fusion_status(MeasureState::OK);
      localization_status-&gt;set_state_message(&quot;&quot;);
      break;
    // RTK FLOAT状态
    case drivers::gnss::SolutionType::INS_RTKFLOAT:
      localization_status-&gt;set_fusion_status(MeasureState::WARNNING);
      localization_status-&gt;set_state_message(
          &quot;Warning: Current Localization Is Unstable.&quot;);
      break;
    default:
      localization_status-&gt;set_fusion_status(MeasureState::ERROR);
      localization_status-&gt;set_state_message(
          &quot;Error: Current Localization Is Very Unstable.&quot;);
      break;
  }
}
</pre></div>
</div>
</div>
<div class="section" id="publishposebroadcasttopic">
<h1>PublishPoseBroadcastTopic<a class="headerlink" href="#publishposebroadcasttopic" title="Permalink to this headline"></a></h1>
<p>输出无人车的位置，为什么没有通过IMU解算真实的位置信息？？？</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalizationComponent</span><span class="p">::</span><span class="n">PublishPoseBroadcastTopic</span><span class="p">(</span>
    <span class="n">const</span> <span class="n">LocalizationEstimate</span><span class="o">&amp;</span> <span class="n">localization</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">localization_talker_</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">localization</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="publishposebroadcasttf">
<h1>PublishPoseBroadcastTF<a class="headerlink" href="#publishposebroadcasttf" title="Permalink to this headline"></a></h1>
<p>输出坐标转换信息，主要发布位置、航向。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalizationComponent</span><span class="p">::</span><span class="n">PublishPoseBroadcastTF</span><span class="p">(</span>
    <span class="n">const</span> <span class="n">LocalizationEstimate</span><span class="o">&amp;</span> <span class="n">localization</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">broadcast</span> <span class="n">tf</span> <span class="n">message</span>
  <span class="n">apollo</span><span class="p">::</span><span class="n">transform</span><span class="p">::</span><span class="n">TransformStamped</span> <span class="n">tf2_msg</span><span class="p">;</span>

  <span class="n">auto</span> <span class="n">mutable_head</span> <span class="o">=</span> <span class="n">tf2_msg</span><span class="o">.</span><span class="n">mutable_header</span><span class="p">();</span>
  <span class="n">mutable_head</span><span class="o">-&gt;</span><span class="n">set_timestamp_sec</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">measurement_time</span><span class="p">());</span>
  <span class="n">mutable_head</span><span class="o">-&gt;</span><span class="n">set_frame_id</span><span class="p">(</span><span class="n">broadcast_tf_frame_id_</span><span class="p">);</span>
  <span class="n">tf2_msg</span><span class="o">.</span><span class="n">set_child_frame_id</span><span class="p">(</span><span class="n">broadcast_tf_child_frame_id_</span><span class="p">);</span>

  <span class="n">auto</span> <span class="n">mutable_translation</span> <span class="o">=</span> <span class="n">tf2_msg</span><span class="o">.</span><span class="n">mutable_transform</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mutable_translation</span><span class="p">();</span>
  <span class="n">mutable_translation</span><span class="o">-&gt;</span><span class="n">set_x</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="p">()</span><span class="o">.</span><span class="n">x</span><span class="p">());</span>
  <span class="n">mutable_translation</span><span class="o">-&gt;</span><span class="n">set_y</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="p">()</span><span class="o">.</span><span class="n">y</span><span class="p">());</span>
  <span class="n">mutable_translation</span><span class="o">-&gt;</span><span class="n">set_z</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">position</span><span class="p">()</span><span class="o">.</span><span class="n">z</span><span class="p">());</span>

  <span class="n">auto</span> <span class="n">mutable_rotation</span> <span class="o">=</span> <span class="n">tf2_msg</span><span class="o">.</span><span class="n">mutable_transform</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">mutable_rotation</span><span class="p">();</span>
  <span class="n">mutable_rotation</span><span class="o">-&gt;</span><span class="n">set_qx</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">orientation</span><span class="p">()</span><span class="o">.</span><span class="n">qx</span><span class="p">());</span>
  <span class="n">mutable_rotation</span><span class="o">-&gt;</span><span class="n">set_qy</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">orientation</span><span class="p">()</span><span class="o">.</span><span class="n">qy</span><span class="p">());</span>
  <span class="n">mutable_rotation</span><span class="o">-&gt;</span><span class="n">set_qz</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">orientation</span><span class="p">()</span><span class="o">.</span><span class="n">qz</span><span class="p">());</span>
  <span class="n">mutable_rotation</span><span class="o">-&gt;</span><span class="n">set_qw</span><span class="p">(</span><span class="n">localization</span><span class="o">.</span><span class="n">pose</span><span class="p">()</span><span class="o">.</span><span class="n">orientation</span><span class="p">()</span><span class="o">.</span><span class="n">qw</span><span class="p">());</span>

  <span class="n">tf2_broadcaster_</span><span class="o">-&gt;</span><span class="n">SendTransform</span><span class="p">(</span><span class="n">tf2_msg</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="publishlocalizationstatus">
<h1>PublishLocalizationStatus<a class="headerlink" href="#publishlocalizationstatus" title="Permalink to this headline"></a></h1>
<p>发布位置状态信息</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span> <span class="n">RTKLocalizationComponent</span><span class="p">::</span><span class="n">PublishLocalizationStatus</span><span class="p">(</span>
    <span class="n">const</span> <span class="n">LocalizationStatus</span><span class="o">&amp;</span> <span class="n">localization_status</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">localization_status_talker_</span><span class="o">-&gt;</span><span class="n">Write</span><span class="p">(</span><span class="n">localization_status</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="ndt">
<h1>NDT<a class="headerlink" href="#ndt" title="Permalink to this headline"></a></h1>
<ol class="arabic simple">
<li><p>NDT的原理？</p></li>
</ol>
<p>NDT mapping
NDT match</p>
<p>我们主要应用NDT（Normal Distributions Transform，正态分布变换）或者其他SLAM算法来完成稠密点云地图的构建。
http://xchu.net/2019/09/27/HDMAP%E5%BB%BA%E5%9B%BE%E6%B5%81%E7%A8%8B/<br />
http://xchu.net/2019/10/11/autoware%E6%BF%80%E5%85%89%E9%9B%B7%E8%BE%BE%E5%BB%BA%E5%9B%BE%E5%92%8C%E5%AE%9A%E4%BD%8D/</p>
<div class="section" id="id7">
<h2><a class="headerlink" href="#id7" title="Permalink to this headline"></a></h2>
</div>
</div>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, daohu527.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>