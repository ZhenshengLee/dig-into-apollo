<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>13. Perception &mdash; dig-into-apollo  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="14. Planning" href="../planning/readme.html" />
    <link rel="prev" title="12. Monitor" href="../monitor/readme.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> dig-into-apollo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">快速开始:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../what_is_apollo/readme.html">1. 什么是Apollo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_to_build/readme.html">2. 如何编译</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/readme.html">3. 启动容器</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../cyber/readme.html">1. Cyber</a></li>
<li class="toctree-l1"><a class="reference internal" href="../audio/readme.html">2. Audio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bridge/readme.html">3. Bridge</a></li>
<li class="toctree-l1"><a class="reference internal" href="../canbus/readme.html">4. Canbus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../control/readme.html">5. Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../data/readme.html">6. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dreamview/readme.html">7. Dreamview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../drivers/readme.html">8. Drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guardian/readme.html">9. Guardian</a></li>
<li class="toctree-l1"><a class="reference internal" href="../localization/readme.html">10. Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../map/readme.html">11. Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../monitor/readme.html">12. Monitor</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">13. Perception</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#table-of-contents">13.1. Table of Contents</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id1">13.2. Perception模块简介</a></li>
<li class="toctree-l2"><a class="reference internal" href="#production">13.3. production目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="#onboard">13.4. onboard目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">13.5. 子模块介绍</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reference">13.6. Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../planning/readme.html">14. Planning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../prediction/readme.html">15. Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing/readme.html">16. Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../routing/readme.html#id5">17. Routing模块分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools/readme.html">18. Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../transform/readme.html">19. Transform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../v2x/readme.html">20. V2X</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/readme.html">21. 性能分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../simulation/readme.html">22. 仿真</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../library/readme.html">23. 引用的库</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../papers/readme.html">24. 论文</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../questions/readme.html">28. 常见问题</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dig-into-apollo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">&lt;no title&gt;</a> &raquo;</li>
      <li><span class="section-number">13. </span>Perception</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/modules/perception/readme.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="perception">
<h1><span class="section-number">13. </span>Perception<a class="headerlink" href="#perception" title="Permalink to this headline"></a></h1>
<blockquote>
<div><p>温故而知新，可以为师矣</p>
</div></blockquote>
<div class="section" id="table-of-contents">
<h2><span class="section-number">13.1. </span>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><span class="xref myst">CNN</span></p>
<ul>
<li><p><span class="xref myst">什么是CNN？</span></p></li>
<li><p><span class="xref myst">CNN的原理</span></p>
<ul>
<li><p><span class="xref myst">卷积层(Convolutional Layer)</span></p></li>
<li><p><span class="xref myst">池化层(Max Pooling Layer)</span></p></li>
<li><p><span class="xref myst">全连接层(Fully Connected Layer)</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">如何构建CNN</span></p></li>
<li><p><span class="xref myst">基本概念</span></p></li>
<li><p><span class="xref myst">引用</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Caffe2</span></p>
<ul>
<li><p><span class="xref myst">Caffe2环境准备</span></p></li>
<li><p><span class="xref myst">安装显卡驱动</span></p></li>
<li><p><span class="xref myst">安装CUDA</span></p>
<ul>
<li><p><span class="xref myst">选择CUDA版本</span></p></li>
<li><p><span class="xref myst">安装CUDA</span></p></li>
<li><p><span class="xref myst">设置环境变量</span></p></li>
<li><p><span class="xref myst">检验安装</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">安装cuDNN</span></p></li>
<li><p><span class="xref myst">安装Caffe2</span></p></li>
<li><p><span class="xref myst">参考</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Perception模块简介</span></p>
<ul>
<li><p><span class="xref myst">production目录</span></p></li>
<li><p><span class="xref myst">onboard目录</span></p></li>
<li><p><span class="xref myst">radar子模块</span></p></li>
<li><p><span class="xref myst">camera子模块</span></p></li>
<li><p><span class="xref myst">lidar子模块</span></p></li>
<li><p><span class="xref myst">fusion子模块</span></p></li>
<li><p><span class="xref myst">inference推理子模块</span></p></li>
<li><p><span class="xref myst">Reference</span></p></li>
</ul>
</li>
</ul>
<a name="introduction" />
</div>
<div class="section" id="id1">
<h2><span class="section-number">13.2. </span>Perception模块简介<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h2>
<p>首先简单看下perception的目录结构：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── BUILD
├── Perception_README_3_5.md
├── README.md
├── base           // 基础类
├── camera         // 相机相关            --- 子模块流程
├── common         // 公共目录
├── data           // 相机的内参和外参
├── fusion         // 传感器融合
├── inference      // 深度学习推理模块
├── lib            // 一些基础的库，包括线程、时间等
├── lidar          // 激光雷达相关         --- 子模块流程
├── map            // 地图
├── model          // 深度学习模型
├── onboard        // 各个子模块的入口     --- 子模块入口
├── production     // 感知模块入口（深度学习模型也存放在这里）--- 通过cyber启动子模块
├── proto          // 数据格式，protobuf
├── radar          // 毫米波               --- 子模块流程
├── testdata       // 上述几个模块的测试数据
└── tool           // 离线测试工具
</pre></div>
</div>
<p>下面介绍几个重要的目录结构:</p>
<ul class="simple">
<li><p>production目录 - <strong>感知模块的入口在production目录，通过lanuch加载对应的dag，启动感知模块</strong>，感知模块包括多个子模块，在onboard目录中定义。</p></li>
<li><p>onboard目录 - 定义了多个子模块，分别用来处理不同的传感器信息（Lidar,Radar,Camera）。各个子模块的入口在onboard目录中，每个传感器的流程大概相似，可以分为预处理，物体识别，感兴趣区域过滤以及追踪。</p></li>
<li><p>inference目录 - 深度学习推理模块，我们知道深度学习模型训练好了之后需要部署，而推理则是深度学习部署的过程，实际上部署的过程会对模型做加速，<strong>主要实现了caffe，TensorRT和paddlepaddle</strong>3种模型部署。训练好的深度模型放在”modules\perception\production\data”目录中，然后通过推理模块进行加载部署和在线计算。</p></li>
<li><p>camera目录 - 主要实现车道线识别，红绿灯检测，以及障碍物识别和追踪。</p></li>
<li><p>radar目录 - 主要实现障碍物识别和追踪（由于毫米波雷达上报的就是障碍物信息，这里主要是对障碍物做追踪）。</p></li>
<li><p>lidar目录 - 主要实现障碍物识别和追踪（对点云做分割，分类，识别等）。</p></li>
<li><p>fusion目录 - 对上述传感器的感知结果做融合。</p></li>
</ul>
<p>整个模块的流程如图：
<img alt="process" src="../../_images/perception_process.jpg" />
可以看到感知模块由production模块开始，由fusion模块结束。</p>
<a name="production" />
</div>
<div class="section" id="production">
<h2><span class="section-number">13.3. </span>production目录<a class="headerlink" href="#production" title="Permalink to this headline"></a></h2>
<p>production中主要是存放：</p>
<ol class="arabic simple">
<li><p>配置和lanuch和dag启动文件</p></li>
<li><p>存放训练好的模型</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── conf  // 配置文件
├── dag   // dag启动文件
├── data  // 训练好的模型
└── launch // cyber launch加载dag
</pre></div>
</div>
<p>该文件中有多个lanuch文件，同时一个lanuch文件中包含多个dag文件，也就是说一个lanuch文件会启动多个子模块。</p>
<a name="onboard" />
</div>
<div class="section" id="onboard">
<h2><span class="section-number">13.4. </span>onboard目录<a class="headerlink" href="#onboard" title="Permalink to this headline"></a></h2>
<p>onboard目录定义了多个子模块，每个子模块对应一个功能，包括：车道线识别，障碍物识别，红绿灯识别，传感器融合，场景分割等。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── common_flags
├── component          // 子模块入口
├── inner_component_messages
├── msg_buffer
├── msg_serializer
├── proto
└── transform_wrapper
</pre></div>
</div>
<p>实际上几个子模块可能合并为一个模块，如何确定模块是否合并呢？我们可以查看”onboard/component”目录中的BUILD文件。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;perception_component_inner_lidar&quot;</span><span class="p">,</span>
    <span class="n">srcs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;fusion_component.cc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lidar_output_component.cc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;radar_detection_component.cc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;recognition_component.cc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;segmentation_component.cc&quot;</span><span class="p">,</span>
        <span class="s2">&quot;detection_component.cc&quot;</span><span class="p">,</span>
    <span class="p">],</span>
</pre></div>
</div>
<p>在BUILD文件中上述几个模块被编译为一个模块”libperception_component_lidar”。也就是说在dag中实际上只需要启动<strong>libperception_component_lidar</strong>这一个模块就相当于启动了上述几个模块。</p>
<p>看完了perception模块的入口，以及各个子模块的定义，那么各个子模块的功能如何实现的呢？  实际上感知各个子模块的功能是通过lidar,radar和camera3种传感器实现的，每种传感器分别都执行了目标识别和追踪的任务，最后通过fusion对传感器的数据做融合，执行代码分别在”perception/radar”,”perception/lidar”,”perception/camera”目录中。这里有2种查看代码的方式，一种是正序的方式，根据具体的功能，例如从物体识别子模块入手，分别查看lidar,radar和camera模块中的物体识别功能，另一种是倒序的方式，根据传感器划分，先查看传感器分别实现了哪些功能，然后回过头来看各个子模块是如何把上述功能整合起来的。这里我们采用第2种方式，先看各个传感器的执行流程如下图。
<img alt="sensor" src="../../_images/sensor.jpg" />
从图中可以看到，每个传感器都实现了物体识别的功能，而摄像头还实现了车道线识别和红绿灯检测的功能，每个传感器执行的任务流水线也大概相似，先进行预处理，然后做识别，最后过滤并且追踪目标。其中物体识别用到了推理引擎inference。</p>
<p>接下来来我们分别查看各个传感器的具体实现。我们先从radar开始看起，主要是radar模块相对比较简单。</p>
<a name="sub_module" />
</div>
<div class="section" id="id2">
<h2><span class="section-number">13.5. </span>子模块介绍<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h2>
<p><span class="xref myst">radar子模块介绍</span>
<span class="xref myst">camera子模块介绍</span>
<span class="xref myst">lidar子模块介绍</span>
<span class="xref myst">fusion子模块</span>
<span class="xref myst">inference推理子模块</span></p>
<a name="reference" />
</div>
<div class="section" id="reference">
<h2><span class="section-number">13.6. </span>Reference<a class="headerlink" href="#reference" title="Permalink to this headline"></a></h2>
<p><a class="reference external" href="https://skymind.ai/wiki/convolutional-network">A Beginner’s Guide to Convolutional Neural Networks</a>
<a class="reference external" href="https://cs231n.github.io/convolutional-networks/">cnn</a>
<a class="reference external" href="https://hci.iwr.uni-heidelberg.de/node/6132/download/3d66608cfb112934ef40175e9a20c81f">traffic light dataset</a>
<a class="reference external" href="https://github.com/yunjey/pytorch-tutorial">pytorch-tutorial</a>
<a class="reference external" href="https://www.zhihu.com/question/41037974">全连接层的作用是什么？</a>
<a class="reference external" href="https://zh.wikipedia.org/wiki/%E7%B4%A2%E8%B2%9D%E7%88%BE%E7%AE%97%E5%AD%90">索伯算子</a>
<a class="reference external" href="https://zh.wikipedia.org/wiki/%E5%8D%B7%E7%A7%AF">卷积</a>
<a class="reference external" href="https://arleyzhang.github.io/articles/7f4b25ce/">TensorRT(1)-介绍-使用-安装</a>
<a class="reference external" href="https://zhuanlan.zhihu.com/p/35657027">高性能深度学习支持引擎实战——TensorRT</a></p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../monitor/readme.html" class="btn btn-neutral float-left" title="12. Monitor" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../planning/readme.html" class="btn btn-neutral float-right" title="14. Planning" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, daohu527.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>